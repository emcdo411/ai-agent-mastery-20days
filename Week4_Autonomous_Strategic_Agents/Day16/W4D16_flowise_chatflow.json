{
  "name": "W4D22 Strategic Agent (Ollama + Chroma RAG, Governance-Ready)",
  "description": "Local Flowise chatflow: Ollama + Chroma RAG over repo files with governance guardrails",
  "nodes": [
    {
      "id": "chat_input",
      "type": "ChatInput",
      "label": "Chat Input"
    },
    {
      "id": "doc_loader",
      "type": "DocumentLoader",
      "label": "Local Files",
      "data": {
        "directory": "./",
        "glob": "**/*.{md,csv,txt}"
      }
    },
    {
      "id": "splitter",
      "type": "TextSplitter",
      "label": "Text Splitter",
      "data": {
        "chunkSize": 1000,
        "chunkOverlap": 150
      }
    },
    {
      "id": "embed",
      "type": "Embeddings",
      "label": "Ollama Embeddings",
      "data": {
        "baseUrl": "http://localhost:11434",
        "model": "nomic-embed-text"
      }
    },
    {
      "id": "chroma",
      "type": "VectorStore",
      "label": "Chroma",
      "data": {
        "collection": "aimastery_w4",
        "persistDirectory": "./vectorstore"
      }
    },
    {
      "id": "retriever",
      "type": "Retriever",
      "label": "Retriever",
      "data": {
        "searchType": "similarity",
        "topK": 5,
        "scoreThreshold": 0.35
      }
    },
    {
      "id": "prompt",
      "type": "PromptTemplate",
      "label": "System Prompt",
      "data": {
        "template": "You are a Strategic AI Coach for a public-sector skills program. Use ONLY retrieved repository context. If the answer is not in the retrieved files, reply: 'I don’t have that in the repo yet. Add the file (e.g., /docs/policy.md).' \n\nOUTPUT RULES\n- Cite filenames after each bullet (e.g., [file.md])\n- Provide concise bullets + an 'Action List'\n- Mask any detected personal info (emails, phones, IDs) as [REDACTED]\n- Never output secrets or API keys\n- If asked something outside scope, respond: 'Outside current scope. Add source file to repo.'\n\nTONE\n- Executive brief, plain language. If helpful, add an Amharic summary line prefixed with 'አጭር ማጠቃለያ:'"
      }
    },
    {
      "id": "llm",
      "type": "LLM",
      "label": "Ollama LLM",
      "data": {
        "baseUrl": "http://localhost:11434",
        "model": "phi3:mini",
        "temperature": 0.0
      }
    },
    {
      "id": "memory",
      "type": "ChatMemory",
      "label": "Chat Memory",
      "data": {
        "windowSize": 5
      }
    },
    {
      "id": "chat_output",
      "type": "ChatOutput",
      "label": "Chat Output"
    }
  ],
  "edges": [
    { "source": "chat_input", "target": "doc_loader" },
    { "source": "doc_loader", "target": "splitter" },
    { "source": "splitter", "target": "embed" },
    { "source": "embed", "target": "chroma" },
    { "source": "chroma", "target": "retriever" },
    { "source": "retriever", "target": "prompt" },
    { "source": "prompt", "target": "llm" },
    { "source": "llm", "target": "memory" },
    { "source": "memory", "target": "chat_output" }
  ]
}


